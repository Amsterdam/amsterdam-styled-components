import { createRef, useEffect, Fragment } from 'react'
import { Meta, Story, Preview } from '@storybook/addon-docs/blocks'
import { action } from '@storybook/addon-actions'
import { Select, Label, ErrorMessage } from '@amsterdam/asc-ui'

export const SelectWithRef = () => {
  const ref = createRef()
  useEffect(() => {
    const element = ref.current
    function onChange(e) {
      action(`Value changed! ${e.target.value}`)(e)
    }
    if (!element) {
      return undefined
    }
    element.addEventListener('change', onChange)
    return () => {
      element.removeEventListener('change', onChange)
    }
  }, [ref])
  return (
    <Select id="with-ref" label="Select with ref" ref={ref}>
      <option value="1">Option 1</option>
      <option value="2">Option 2</option>
      <option value="3">Option 3</option>
      <option value="4">Option 4</option>
    </Select>
  )
}

<Meta
  title="UI/Form/Select (Dropdown)"
  component={Select}
  decorators={[
    (storyFn) => (
      <div
        style={{
          width: '400px',
        }}
      >
        {storyFn()}
      </div>
    ),
  ]}
/>

# Select (dropdown)

Use this component as a last resort, because some users are having trouble
with it. Try to use Radio Buttons first, or in case of a long list, try
to ask multiple questions (text from Design System)

[Design System](https://designsystem.amsterdam.nl/7awj1hc9f/p/6561a5-selection-dropdown)

**Component status: experimental**

## Default state

<Preview>
  <Story name="Default state">
    <Select id="select-1" label="Label">
      <option value="1">Option 1</option>
      <option value="2">Option 2</option>
      <option value="3">Option 3</option>
      <option value="4">Option 4</option>
    </Select>
  </Story>
</Preview>

## Selected state

<Preview>
  <Story name="Selected state">
    <Select id="select-1" label="Label" defaultValue="2">
      <option value="1">Option 1</option>
      <option value="2">Option 2</option>
      <option value="3">Option 3</option>
      <option value="4">Option 4</option>
    </Select>
  </Story>
</Preview>

## Disabled state

<Preview>
  <Story name="Disabled state">
    <Fragment>
      <Select id="select-1" label="Disabled Select component" disabled>
        <option value="1">Option 1</option>
        <option value="2">Option 2</option>
        <option value="3">Option 3</option>
        <option value="4">Option 4</option>
      </Select>
      <br />
      <br />
      <Select id="select-2" label="Disabled specific Option">
        <option value="1" disabled>
          Option 1
        </option>
        <option value="2">Option 2</option>
        <option value="3">Option 3</option>
        <option value="4">Option 4</option>
      </Select>
    </Fragment>
  </Story>
</Preview>

## Error state

<Preview>
  <Story name="Error state">
    <Fragment>
      <Select id="select-1" label="With Error Message" error>
        <option value="1">Option 1</option>
        <option value="2">Option 2</option>
        <option value="3">Option 3</option>
        <option value="4">Option 4</option>
      </Select>
      <ErrorMessage message="Error message" />
      <br />
      <br />
      <Select id="select-2" label="Without Error Message" error>
        <option value="1">Option 1</option>
        <option value="2">Option 2</option>
        <option value="3">Option 3</option>
        <option value="4">Option 4</option>
      </Select>
    </Fragment>
  </Story>
</Preview>

## With ref

<Preview>
  <Story name="With ref">
    <SelectWithRef />
  </Story>
</Preview>

## With long text

<Preview>
  <Story name="With long text">
    <Select id="select-1" label="Select with long text">
      <option value="1">
        Option 1 - with a very very long description that overflows
      </option>
      <option value="2">
        Option 2 - with a very very long description that overflows
      </option>
      <option value="3">
        Option 3 - with a very very long description that overflows
      </option>
      <option value="4">
        Option 4 - with a very very long description that overflows
      </option>
    </Select>
  </Story>
</Preview>

## With the label component wrapped around

<Preview>
  <Story name="With the label component wrapped around">
    <Label htmlFor="select-with-label" label="Test">
      <Select id="select-with-label">
        <option value="1">
          Option 1 - with a very very long description that overflows
        </option>
        <option value="2">
          Option 2 - with a very very long description that overflows
        </option>
        <option value="3">
          Option 3 - with a very very long description that overflows
        </option>
        <option value="4">
          Option 4 - with a very very long description that overflows
        </option>
      </Select>
    </Label>
  </Story>
</Preview>
